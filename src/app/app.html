<main class="page">
  <section class="panel">
    <header class="panel__header">
      <div>
        <p class="eyebrow">Завдання для лайв-кодингу</p>
      </div>
      <div class="token-chip" [class.token-chip--valid]="hasValidToken()" [class.token-chip--invalid]="!hasValidToken() && token()">
        <span class="label">Токен</span>
        <span class="value">{{ token() || 'немає' }}</span>
      </div>
    </header>

    <div class="controls">
      <button class="cta" type="button" (click)="startBurst()" [disabled]="isRunning()">
        Запустити запити
      </button>
    </div>

    <div class="request-list" *ngIf="requests().length; else emptyState">
      @for (request of requests(); track trackById) {
        <article class="request" [class.request--success]="request.status === 'success'" [class.request--error]="request.status === 'error'">
          <div class="request__meta">
            <p class="request__title">Запит {{ request.id }}</p>
            <p class="request__status">
              @switch (request.status) {
                @case ('pending') { очікує на токен }
                @case ('success') { успіх }
                @case ('error') { 401 / помилка }
              }
            </p>
          </div>
          @if (request.payload) {
            <pre class="payload">{{ request.payload | json }}</pre>
          } @else if (request.error) {
            <pre class="payload error">HTTP {{ request.error.status }} - {{ request.error.statusText }}</pre>
          }
        </article>
      }
    </div>
    <ng-template #emptyState>
      <p class="muted">Запустіть серію, щоб побачити запити.</p>
    </ng-template>

  </section>
</main>
